(function(e){function t(t){for(var a,o,l=t[0],s=t[1],c=t[2],p=0,d=[];p<l.length;p++)o=l[p],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,l=1;l<n.length;l++){var s=n[l];0!==r[s]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={app:0},i=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/bpmn-modeler/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"238b":function(e,t,n){"use strict";var a=n("8ed9"),r=n.n(a);r.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("vue-bpmn")],1)},i=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flow-containers"},[n("el-container",[n("el-header",[n("div",{staticStyle:{display:"flex",padding:"10px 20px"}},[n("el-upload",{staticClass:"load",staticStyle:{"margin-riight":"20px"},attrs:{action:"","before-upload":e.openBpmn}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-folder-opened",type:"primary"}},[e._v("加载xml")])],1),n("el-button",{attrs:{size:"mini",icon:"el-icon-circle-plus",type:"primary"},on:{click:e.newDiagram}},[e._v("新建")]),n("el-button",{attrs:{size:"mini",icon:"el-icon-download",type:"primary"},on:{click:function(t){return e.saveFile("xml")}}},[e._v("下载xml")]),n("el-button",{attrs:{size:"mini",icon:"el-icon-picture",type:"primary"},on:{click:function(t){return e.saveFile("svg")}}},[e._v("下载svg")])],1)]),n("el-container",{staticStyle:{"align-items":"stretch"}},[n("el-main",{attrs:{height:"100%"}},[n("div",{ref:"canvas",staticClass:"canvas"})]),n("el-aside",{staticStyle:{width:"300px","background-color":"#f0f2f5"}},[e.modeler?n("panel",{attrs:{modeler:e.modeler,users:e.users}}):e._e()],1)],1)],1)],1)},l=[],s=(n("c975"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("96cf"),n("1da1")),c=n("c49e");a["default"].use(c["a"],{input:{size:"mini"},xform:{form:{labelPosition:"top",size:"mini"}}});var u=n("7024"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"propertyPanel",staticClass:"property-panel"},[e.element?n(e.getComponent,{tag:"component",attrs:{element:e.element,modeler:e.modeler,users:e.users,groups:e.groups}}):e._e()],1)},d=[],m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("x-form",{ref:"xForm",attrs:{config:e.formConfig},model:{value:e.formData,callback:function(t){e.formData=t},expression:"formData"}})],1)},f=[],b=(n("4160"),n("a15b"),n("ac1f"),n("5319"),n("1276"),n("5530")),h={props:{modeler:{type:Object,required:!0},element:{type:Object,required:!0}},watch:{"formData.id":function(e){this.updateProperties({id:e})},"formData.name":function(e){this.updateProperties({name:e})},"formData.color":function(e){this.setColor({fill:null,stroke:e}),this.updateProperties({color:e})}},methods:{updateProperties:function(e){var t=this.modeler.get("modeling");t.updateProperties(this.element,e)},setColor:function(e){var t=this.modeler.get("modeling");t.setColor(this.element,e)}}},v={mixins:[h],props:{users:{type:Array,required:!0},groups:{type:Array,required:!0}},data:function(){return{userTypeOption:[{label:"指定人员",value:"assignee"},{label:"候选人员",value:"candidateUsers"},{label:"候选组",value:"candidateGroups"}],formData:{}}},computed:{formConfig:function(){var e=this;return{inline:!1,item:[{xType:"input",name:"id",label:"节点 id",rules:[{required:!0,message:"Id 不能为空"}]},{xType:"input",name:"name",label:"节点名称"},{xType:"colorPicker",name:"color",label:"节点颜色"},{xType:"select",name:"userType",label:"人员类型",dic:e.userTypeOption},{xType:"select",name:"assignee",label:"指定人员",allowCreate:!0,filterable:!0,dic:e.users,show:"assignee"===e.formData.userType},{xType:"select",name:"candidateUsers",label:"候选人员",multiple:!0,allowCreate:!0,filterable:!0,dic:e.users,show:"candidateUsers"===e.formData.userType},{xType:"select",name:"candidateGroups",label:"候选组",multiple:!0,allowCreate:!0,filterable:!0,dic:e.groups,show:"candidateGroups"===e.formData.userType},{xType:"switch",name:"async",label:"异步",activeText:"是",inactiveText:"否"},{xType:"input",name:"priority",label:"优先级"},{xType:"input",name:"formKey",label:"表单标识key"},{xType:"input",name:"skipExpression",label:"跳过表达式"},{xType:"datePicker",type:"datetime",name:"dueDate",label:"到期时间"}]}}},watch:{"formData.userType":function(e){var t=this,n=["assignee","candidateUsers","candidateGroups"];n.forEach((function(e){delete t.element.businessObject.$attrs["flowable:".concat(e)],delete t.formData[e]}))},"formData.assignee":function(e){"assignee"===this.formData.userType&&this.updateProperties({"flowable:assignee":e})},"formData.candidateUsers":function(e){"candidateUsers"===this.formData.userType&&this.updateProperties({"flowable:candidateUsers":null===e||void 0===e?void 0:e.join(",")})},"formData.candidateGroups":function(e){"candidateGroups"===this.formData.userType&&this.updateProperties({"flowable:candidateGroups":null===e||void 0===e?void 0:e.join(",")})},"formData.async":function(e){e?this.updateProperties({"flowable:async":!0}):delete this.element.businessObject.$attrs["flowable:async"]},"formData.dueDate":function(e){e?this.updateProperties({"flowable:dueDate":e}):delete this.element.businessObject.$attrs["flowable:dueDate"]},"formData.formKey":function(e){e?this.updateProperties({"flowable:formKey":e}):delete this.element.businessObject.$attrs["flowable:formKey"]},"formData.priority":function(e){e?this.updateProperties({"flowable:priority":e}):delete this.element.businessObject.$attrs["flowable:priority"]},"formData.skipExpression":function(e){e?this.updateProperties({"flowable:skipExpression":e}):delete this.element.businessObject.$attrs["flowable:skipExpression"]},element:{handler:function(e){var t=Object(b["a"])(Object(b["a"])({},this.element.businessObject),this.element.businessObject.$attrs);for(var n in t)if(0===n.indexOf("flowable:")){var a,r=n.replace("flowable:","");if(t[r]=t[n],delete t[n],"candidateUsers"===r)t.userType="candidateUsers",t[r]=(null===(a=t[r])||void 0===a?void 0:a.split(","))||[];else if("candidateGroups"===r){var i;t.userType="candidateGroups",t[r]=(null===(i=t[r])||void 0===i?void 0:i.split(","))||[]}else"assignee"===r&&(t.userType="assignee")}this.formData=t},immediate:!0}}},x=v,y=n("2877"),w=Object(y["a"])(x,m,f,!1,null,null,null),g=w.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("x-form",{ref:"xForm",attrs:{config:e.formConfig},model:{value:e.formData,callback:function(t){e.formData=t},expression:"formData"}})],1)},O=[],P={mixins:[h],props:{users:{type:Array,required:!0},groups:{type:Array,required:!0}},data:function(){return{formData:{}}},computed:{formConfig:function(){return{inline:!1,item:[{xType:"input",name:"id",label:"节点 id",rules:[{required:!0,message:"Id 不能为空"}]},{xType:"input",name:"name",label:"节点名称"},{xType:"colorPicker",name:"color",label:"节点颜色"},{xType:"input",name:"initiator",label:"初始化器（流程）"},{xType:"input",name:"formKey",label:"表单标识key"}]}}},watch:{"formData.initiator":function(e){e?this.updateProperties({"flowable:initiator":e}):delete this.element.businessObject.$attrs["flowable:initiator"]},"formData.formKey":function(e){e?this.updateProperties({"flowable:formKey":e}):delete this.element.businessObject.$attrs["flowable:formKey"]},element:{handler:function(e){var t=Object(b["a"])(Object(b["a"])({},this.element.businessObject),this.element.businessObject.$attrs);for(var n in t)if(0===n.indexOf("flowable:")){var a=n.replace("flowable:","");t[a]=t[n],delete t[n]}this.formData=t},immediate:!0}}},j=P,T=Object(y["a"])(j,D,O,!1,null,null,null),k=T.exports,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("x-form",{ref:"xForm",attrs:{config:e.formConfig},model:{value:e.formData,callback:function(t){e.formData=t},expression:"formData"}})],1)},_=[],C={mixins:[h],data:function(){return{formData:{}}},computed:{formConfig:function(){return{inline:!1,item:[{xType:"input",name:"id",label:"流程标识 key",rules:[{required:!0,message:"Id 不能为空"}]},{xType:"input",name:"name",label:"流程名称"},{xType:"colorPicker",name:"color",label:"节点颜色"}]}}},watch:{element:{handler:function(e){var t=Object(b["a"])(Object(b["a"])({},this.element.businessObject),this.element.businessObject.$attrs);for(var n in t)if(0===n.indexOf("flowable:")){var a=n.replace("flowable:","");t[a]=t[n],delete t[n]}this.formData=t},immediate:!0}}},M=C,$=Object(y["a"])(M,E,_,!1,null,null,null),N=$.exports,B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("x-form",{ref:"xForm",attrs:{config:e.formConfig},model:{value:e.formData,callback:function(t){e.formData=t},expression:"formData"}})],1)},S=[],F={mixins:[h],data:function(){return{formData:{}}},computed:{formConfig:function(){return{inline:!1,item:[{xType:"input",name:"id",label:"节点 id",rules:[{required:!0,message:"Id 不能为空"}]},{xType:"input",name:"name",label:"节点名称"},{xType:"colorPicker",name:"color",label:"节点颜色"},{xType:"input",name:"conditionExpression",label:"跳转条件"},{xType:"input",name:"skipExpression",label:"跳过表达式"}]}}},watch:{"formData.conditionExpression":function(e){if(e){var t=this.modeler.get("moddle").create("bpmn:FormalExpression",{body:"<![CDATA[".concat(e,"]]>")});this.updateProperties({conditionExpression:t})}else delete this.element.businessObject["conditionExpression"]},"formData.skipExpression":function(e){e?this.updateProperties({skipExpression:e}):delete this.element.businessObject.$attrs["skipExpression"]},element:{handler:function(e){var t=Object(b["a"])(Object(b["a"])({},this.element.businessObject),this.element.businessObject.$attrs);for(var n in t){if(0===n.indexOf("flowable:")){var a=n.replace("flowable:","");t[a]=t[n],delete t[n]}var r;if("conditionExpression"===n)t[n]=null===(r=t[n].body)||void 0===r?void 0:r.replace(/<!\[CDATA\[(.+)\]\]>/,"$1")}this.formData=t},immediate:!0}}},U=F,q=Object(y["a"])(U,B,S,!1,null,null,null),L=q.exports,z={name:"PropertyPanel",components:{processPanel:N,taskPanel:g,startEndPanel:k,sequenceFlowPanel:L},props:{modeler:{type:Object,required:!0}},data:function(){return{element:null,form:{id:"",name:"",color:null},users:[{label:"张三",value:"zhangsan"},{label:"李四",value:"lisi"},{label:"王五",value:"wangwu"}],groups:[{label:"web组",value:"web"},{label:"java组",value:"java"},{label:"python组",value:"python"}],roles:[{value:"manager",label:"经理"},{value:"personnel",label:"人事"},{value:"charge",label:"主管"}]}},computed:{getComponent:function(){var e,t=null===(e=this.element)||void 0===e?void 0:e.type;return"bpmn:StartEvent"===t||"bpmn:EndEvent"===t?"startEndPanel":"bpmn:UserTask"===t?"taskPanel":"bpmn:SequenceFlow"===t?"sequenceFlowPanel":"bpmn:Process"===t?"processPanel":null}},mounted:function(){this.handleModeler()},methods:{handleModeler:function(){var e=this;this.modeler.on("element.click",(function(t){var n=t.element;"bpmn:Process"===n.type&&(e.element=n)})),this.modeler.on("selection.changed",(function(t){e.element=null;var n=t.newSelection[0];n&&e.$nextTick().then((function(){console.log(n),e.element=n}))}))}}},G=z,R=(n("d7ca"),Object(y["a"])(G,p,d,!1,null,null,null)),A=R.exports,K=(n("4de4"),n("d4ec")),I=n("bee2"),X=function(){function e(){Object(K["a"])(this,e),this.controls=[],this.init()}return Object(I["a"])(e,[{key:"init",value:function(){this.controls=[{action:"create.start-event",title:"开始"},{action:"create.intermediate-event",title:"中间"},{action:"create.end-event",title:"结束"},{action:"create.exclusive-gateway",title:"网关"},{action:"create.task",title:"任务"},{action:"create.user-task",title:"用户任务"},{action:"create.user-sign-task",title:"会签任务"},{action:"create.subprocess-expanded",title:"子流程"},{action:"create.data-object",title:"数据对象"},{action:"create.data-store",title:"数据存储"},{action:"create.participant-expanded",title:"扩展流程"},{action:"create.group",title:"分组"}]}},{key:"getControl",value:function(e){var t=this.controls.filter((function(t){return t.action===e}));return t[0]||{}}}]),e}();n("99af"),n("fb6a"),n("25f0");function J(){return Math.random().toString(36).slice(-8)}var V='<?xml version="1.0" encoding="UTF-8"?>\n<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:flowable="http://flowable.org/bpmn" targetNamespace="http://www.flowable.org/processdef">\n  <process id="process_'.concat(J(),'" name="name_').concat(J(),'">\n    <startEvent id="startNode1" name="开始" />\n  </process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_flow">\n    <bpmndi:BPMNPlane id="BPMNPlane_flow" bpmnElement="T-2d89e7a3-ba79-4abd-9f64-ea59621c258c">\n      <bpmndi:BPMNShape id="BPMNShape_startNode1" bpmnElement="startNode1" bioc:stroke="">\n        <omgdc:Bounds x="240" y="200" width="30" height="30" />\n        <bpmndi:BPMNLabel>\n          <omgdc:Bounds x="242" y="237" width="23" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</definitions>\n'),H={components:{panel:A},data:function(){return{modeler:null,bpmData:new X,users:[{label:"张三",value:"zhangsan"},{label:"李四",value:"lisi"},{label:"王二",value:"wanger"},{label:"麻子",value:"mazi"}]}},mounted:function(){this.modeler=new u["a"]({container:this.$refs.canvas}),this.newDiagram(),this.modeler.get("canvas").zoom("fit-viewport")},methods:{newDiagram:function(){this.createNewDiagram(V)},createNewDiagram:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.modeler.importXML(e);case 3:t.adjustPalette(),n.next=9;break;case 6:n.prev=6,n.t0=n["catch"](0),console.error(n.t0.message,n.t0.warnings);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))()},adjustPalette:function(){try{var e=this.$refs.canvas,t=e.children[0].children[1].children[4],n={width:"130px",padding:"5px",background:"white",left:"20px",borderRadius:0};for(var a in n)t.style[a]=n[a];var r=t.children[0],i=r.children;for(var o in i[0].style["display"]="none",i){var l=i[o];for(var s in l.children){var c=l.children[s],u={display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%",padding:"5px"};if(c.className&&c.dataset&&-1!==c.className.indexOf("entry")){var p=this.bpmData.getControl(c.dataset.action);for(var d in c.innerHTML="<div style='font-size: 14px;font-weight:500;margin-left:15px;'>".concat(p["title"],"</div>"),u)c.style[d]=u[d]}}}}catch(m){console.log(m)}},saveFile:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a,r,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,"xml"!==e){n.next=9;break}return n.next=4,t.modeler.saveXML({format:!0});case 4:a=n.sent,r=a.xml,t.downloadFile("测试.bpmn20.xml",r,"application/xml"),n.next=14;break;case 9:return n.next=11,t.modeler.saveSVG({format:!0});case 11:i=n.sent,o=i.svg,t.downloadFile("图像",o,"image/svg+xml");case 14:n.next=19;break;case 16:n.prev=16,n.t0=n["catch"](0),console.log(n.t0);case 19:case"end":return n.stop()}}),n,null,[[0,16]])})))()},openBpmn:function(e){var t=this,n=new FileReader;return n.readAsText(e,"utf-8"),n.onload=function(){t.createNewDiagram(n.result)},!1},downloadFile:function(e,t,n){var a=document.createElement("a"),r=window.URL.createObjectURL(new Blob([t],{type:n}));a.href=r,a.download=e,a.click(),window.URL.revokeObjectURL(r)}}},Q=H,W=(n("238b"),Object(y["a"])(Q,o,l,!1,null,null,null)),Y=W.exports,Z={components:{VueBpmn:Y}},ee=Z,te=(n("5c0b"),Object(y["a"])(ee,r,i,!1,null,null,null)),ne=te.exports,ae=n("5c96"),re=n.n(ae);n("0fae");a["default"].config.productionTip=!1,a["default"].use(re.a),new a["default"]({render:function(e){return e(ne)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var a=n("9c0c"),r=n.n(a);r.a},6129:function(e,t,n){},"8ed9":function(e,t,n){},"9c0c":function(e,t,n){},d7ca:function(e,t,n){"use strict";var a=n("6129"),r=n.n(a);r.a}});